#!/bin/bash

# 未コミットの各ファイルを個別にコミットする
# 使用方法: git commit-each-file

set -e

# git status --porcelain の出力から未コミットファイルをループ処理
git status --porcelain | while IFS= read -r line; do
  # ファイル名を取得（3文字目以降）
  file="${line:3}"

  # ファイル名が空でない場合のみ処理
  if [ -n "$file" ]; then
    echo "Processing: $file"

    # ファイルの追加または削除を検出してaddまたはrm実行
    if (git add "$file" 2>/dev/null || git rm "$file" 2>/dev/null); then
      # コミット実行（ファイル名をコミットメッセージとして使用）
      git commit -m "$file"
      echo "Committed: $file"
    else
      echo "Failed to process: $file"
    fi
  fi
done

echo "All files processed."