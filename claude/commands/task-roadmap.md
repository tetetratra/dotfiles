$ARGUMENTS

## 目的

タスクの現状を分析し、次に実行すべき作業を提案します。

一般に、あるタスクを与えられたとき、それを遂行するための抽象的な手順を考えるところから始めると思います。
ここでいう手順というのは、具体的な作業ではなくメタ的な作業単位のことであり、
「このタスクは目的が十分に明確化されていないから、まずは『背景・目的の整理』からはじめよう」
「このタスクはやるだけのタスクだから、いきなり『実装』からはじめよう」
などの『背景・目的の整理』『実装』を指しています。(実際にどう整理や実装をやっていくかを指しているわけではありません)

まずは抽象的な手順を考え、その後に具体的な作業内容を考え、それをユーザーに提案します。

## 手法

### Step 1: 初期分析

まずは、与えられた課題に関する関連情報を、十分に収集してください。
タスクのチケットなどが与えられた場合、関連するタスクのチケットやドキュメント、過去の議論なども参照してください。
また、関連するコードがあれば、それも確認してください。

続いて、以下の5つの観点をもとに、調べきれていない情報や不明点があれば追加で調べてください。

それでも不明点が残る場合は、その不明点が後段の作業ステップで解決できるものである場合はその後段の作業ステップで解決することにしてください。
例として、タスクの要件が不足している場合であっても、「要件定義」の段階でそれを明確化できるのであれば、その不明点はそのままにしておいて構いません。
後段の作業ステップで解決できず、今最初に解決しなければならない不明点がある場合は、その不明点をユーザーに質問してください。

**観点**

1. **因果関係の明確性**
   - 入力と出力の関係は自明か？
   - 成功基準は明確に定義できるか？

2. **前例の存在**
   - 類似の問題を解決した経験はあるか？
   - 業界標準やベストプラクティスは存在するか？

3. **予測可能性**
   - 結果を事前に予測できるか？
   - 副作用やリスクを列挙できるか？

4. **専門知識の必要性**
   - 特定のドメイン知識が必要か？
   - 複数の専門領域にまたがるか？

5. **制約条件**
   - 時間的な緊急性はあるか？
   - 技術的・ビジネス的制約は何か？

### Step 2: 作業ステップの構築

[注意] Step 1が完了してから着手してください

作業ステップを構築します。

まず、作業ステップを構築する際の参考として、一般的な作業ステップの種類と、そのステップにおいて利用を勧めるカスタムコマンドを以下に示します。
タスクの性質に応じて、必要なステップを選択・組み合わせます。

#### 作業ステップの例

- **背景・目的の整理**: なぜこのタスクが必要なのか、何を達成したいのかを明確にする
  - 推奨するコマンド: `/task-background`
- **既存システム・関連技術の調査**: 今回のタスクに関連するシステムの仕組み・技術・概念について調査をし、意思決定の判断材料を揃える
  - 推奨するコマンド: なし
- **既存システムの理解促進**: 今回のタスクに関連するシステムの仕組みについて、**ユーザーの理解を深めさせる**
  - 推奨するコマンド: `/task-survey`
- **関連技術の理解促進**: 今回のタスクに関連する技術や概念について、**ユーザーの理解を深めさせる**
  - 推奨するコマンド: `/task-research`
- **要求定義**: 要求を確定する。ユーザーに提案し、合意を得る
  - 推奨するコマンド: `/task-requirements`
- **要件定義**: 機能要件・非機能要件を定める。要件をユーザーに提案し、合意を得る
  - 推奨するコマンド: `/task-requirements`
- **対応方針決め**: 解決策を検討し、ユーザーに提案し、対応方針を決定する
  - 推奨するコマンド: `/task-solution`
- **技術選定**: どの技術・ライブラリ・アーキテクチャを採用するかを決定する
  - 推奨するコマンド: なし
- **設計**: システム設計、データモデル設計、API設計などを行う
  - 推奨するコマンド: `/task-architecture`
- **実装計画**: どのコード（テストコード含む）をどの順番で、どれくらいの段階を踏んで実装していくかを計画する
  - 推奨するコマンド: `/task-implementation-plan`
- **実装**: 実際にコードを書く
  - 推奨するコマンド: なし
- **検証環境上で動作確認**: 検証環境やステージング環境で実際の動作を確認する
  - 推奨するコマンド: `/task-verification`
- **PR作成**: 実装内容をPRにまとめる
  - 推奨するコマンド: `/task-write-pr`
- **レビュー修正**: レビューを受けてその対応を行う
  - 推奨するコマンド: `/task-pr-followup`
- **ドキュメント作成**: README、設計書、運用手順書などを作成する
  - 推奨するコマンド: なし
- **残りステップの再検討**: 前段のステップで得られた結論をもとに、次に実施すべきステップを改めて検討する
  - 推奨するコマンド: `/task-roadmap`

次に、以下のフローチャートに従って、タスクの作業ステップを構築してください。

質問には以下のラベルがついており、それぞれ以下の意味を持ちます。
[Q]: (Questionの意) このラベルがついている質問は、ユーザーに実際に質問をして応答を終了し、次の会話からフローチャートを再開してください
[T]: (Thinkの意) このラベルがついている質問は、機械的に判定できない、判断に思考を要する質問です

フローチャートには、タスク分解に関する質問も含まれています。
タスク分解をする/しないの判断基準については以下の通りなので、こちらに従って判断してください。

判断基準: タスクの作業ステップが上流から下流に一直線に進まない場合、子タスクに分解したほうが良いです。
          例えば「Aの調査→Aの設計→Aの実装→Bの調査→Bの設計→Bの実装」という作業ステップがあった場合、
          これは (Aの)実装から(Bの)設計という下流から上流に戻る流れが発生しているため、
          「Aの調査→Aの設計→Aの実装」と「Bの調査→Bの設計→Bの実装」の2つの子タスクに分解すべきです。

またフローチャートには、「残りステップの再検討」というステップを追加して終了するよう指示している箇所があります。
これは、タスクの解像度が低い状態で無理に全ステップを計画することを避けるためです。
一般に複雑なタスクでは、前段のステップで得られた情報や結論によって後段のアプローチが大きく変わる可能性があるため、最初の段階で後段のステップをすべて見積もることは困難です。
そのため、解像度を上げるためのステップの追加後は「残りステップの再検討」をしてもらうようにしています。

#### フローチャート

- タスクの背景・目的は整理されていますか？
  - yes: 次へ
  - no: 「背景・目的の整理」「残りステップの再検討」を追加し、終了

- [T] あなた(AI)は今回のタスクについて、「対応方針を検討できる」もしくは「子タスクへの分解の検討ができる」
      ほどの関連システム・関連技術の情報を持っていますか？
  - yes: 次へ
  - no: 「関連システム・関連技術の調査」「残りステップの再検討」を追加し、終了

- [Q] ユーザーに、今回のタスクの関連システムと関連技術を伝え、理解しているかどうかの質問を応答として返してください(フローチャートは一時中断してください)。
      得られた回答について、ユーザーは今回のタスクの関連システム・関連技術について理解していましたか？
  - yes: 次へ
  - no: 「関連システムの理解促進」や「関連技術の理解促進」を追加し、次へ

- [T] 今回のタスクを完了するために、複数の子タスクに分解して実行するほどのタスクだと思いますか？
  - yes(= 子タスクに分解すべき): 「タスク分解」というステップを追加し、終了
  - no(= このタスク1個で十分): 次へ
  - unknown(= 不明・まだ判断できない): 次へ

- タスクの要求事項(ビジネス的に求められている事柄)はすでに定義されていますか？もしくは自明(= タスクの目的そのまま)ですか？
  - yes: 次へ
  - no: 「要求定義」を追加し、次へ

- タスクの要件(どのような仕様にするか)はすでに定義されている、もしくは自明(= タスクの目的そのまま)ですか？
  - yes: 次へ
  - no: 「要件定義」を追加し、次へ

- タスクの対応方針は自明、もしくはすでに決定されていますか？
  - yes: 次へ
  - no: 「対応方針決め」「残りステップの再検討」を追加し、終了

- [T] 対応方針について、改めて、その対応方針を進めるにあたって複数の子タスクに分解して実行すべきと思いますか？
  - yes(= 子タスクに分解すべき): 「タスク分解」というステップを追加し、終了
  - no(= このタスク1個で十分): 次へ

- [T] 決定した対応方針について、その決定を踏まえて、改めて詳細事項を詰めるために、
  要求定義(ビジネス的に求められている事柄の整理検討)や要件定義(どのような仕様にするかの整理検討)は必要ですか？
  - yes: 「要求定義」「要件定義」のうち必要なものを追加し、次へ
  - no: 次へ

- 対応方針は、どのたぐいの方針ですか？
  - 開発を伴う方針: 「設計」「実装計画」「実装」「検証環境上で動作確認」「PR作成」「レビュー修正」を追加し、次へ
  - その他：対応方針に応じたステップを任意の数追加し、次へ

- 完了

### Step 3: 作業ステップの確定

[注意] Step 2が完了してから着手してください

以下の出力フォーマットで、提案内容を出力してください。
そして、この内容で問題ないかをユーザーに確認してください。
確認が取れたら、Step 4に進みます。

```
## 作業ステップの提案
1. {ステップ名} ({推奨するコマンド}): {そのステップで行うこと}
2. {ステップ名} ({推奨するコマンド}): {そのステップで行うこと}
...

## 理由
- {回答した判定フローチャートの質問}: {yes/no などの判断}
  - 判断理由: {判断理由を完結に}
  - 追加したステップ: {追加したステップ名があれば記載}
- {回答した判定フローチャートの質問}: {yes/no などの判断}
  - 判断理由: {判断理由を完結に}
  - 追加したステップ: {追加したステップ名があれば記載}
...

{作業ステップの提案理由について、まとめのコメントがあればここに記載}
```
