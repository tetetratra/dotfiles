$1

## 目的

タスクの現状を分析し、次に実行すべき作業を提案します。

一般に、あるタスクを与えられたとき、それを遂行するための抽象的な手順を考えるところから始めると思います。
ここでいう手順というのは、具体的な作業ではなくメタ的な作業単位のことであり、
「このタスクは目的が十分に明確化されていないから、まずは『背景・目的の整理』からはじめよう」
「このタスクはやるだけのタスクだから、いきなり『実装』からはじめよう」
などの『背景・目的の整理』『実装』を指しています。(実際にどう整理や実装をやっていくかを指しているわけではありません)

まずは抽象的な手順を考え、その後に具体的な作業内容を考え、それをユーザーに提案します。

## 手法

### Step 0: 情報収集

まずは、与えられた課題に関する関連情報を、十分に収集してください。
タスクのチケットなどが与えられた場合、関連するタスクのチケットやドキュメント、過去の議論なども参照してください。
また、関連するコードがあれば、それも確認してください。

### Step 1: 初期分析（対話的確認）

以下の5つの観点からタスクを分析します。

分析にあたって情報が不足している場合は改めて情報収集を行い、
それでも判断材料が無い場合、仮の答えを出してください。
本当にわからない場合、不明と回答してください。

必要に応じてユーザーに確認・質問を行います：

1. **因果関係の明確性**
   - 入力と出力の関係は自明か？
   - 成功基準は明確に定義できるか？

2. **前例の存在**
   - 類似の問題を解決した経験はあるか？
   - 業界標準やベストプラクティスは存在するか？

3. **予測可能性**
   - 結果を事前に予測できるか？
   - 副作用やリスクを列挙できるか？

4. **専門知識の必要性**
   - 特定のドメイン知識が必要か？
   - 複数の専門領域にまたがるか？

5. **制約条件**
   - 時間的な緊急性はあるか？
   - 技術的・ビジネス的制約は何か？

### Step 2: ユーザーへの確認事項の整理

以下の観点で、AI側では判断できない事柄をユーザーに質問します。
該当する項目がある場合は、まとめて質問してください。

- **確認A**: タスクに関連する既存システムや機能について、理解しているか？
  - 理解していない場合、Step 4にて「(それらの)既存システムや機能を(ユーザーが)理解する」という作業ステップを追加してください
  - 今このロードマップを引いている作業中に調査・説明する必要はありません

- **確認B**: タスクに必要な新しい技術・概念について、理解しているか？
  - 理解していない場合、Step 4にて「(それらの)新しい技術・概念を(ユーザーが)理解する」という作業ステップを追加してください
  - 今このロードマップを引いている作業中に調査・説明する必要はありません

- **確認C**: タスク完了後、結果を正式に報告・ドキュメント化する必要があるか？
  - 必要な場合、どのような形式で報告するか？

- **確認D**: このタスクの進め方について、特別な希望や要望はあるか？

### Step 3: タスクの解像度の推定

Step 1の分析結果をもとに、タスクの解像度を推定します。
タスクの解像度というのは、そのタスクの完了までの道筋の明瞭さを指します。

**なぜタスクの解像度を判定するのか**

複雑なタスクでは、最初の段階で後段のステップをすべて見積もることは困難です。
前段のステップで得られた情報や結論によって、後段のアプローチが大きく変わる可能性があるためです。
無理に全ステップを計画すると、後で大幅な修正が必要になり、かえって非効率になります。

まずはじめにタスクの解像度を推定することで、高い確度で計画できる部分までのみを提案し、計画がずれるリスクを低減します。

**判定基準**

以下いずれか該当するタスクは、解像度の低いタスクです。

- 因果関係が不明確（入力と出力の関係が自明でない、成功基準が曖昧）
- 対応方法を検討する必要がある（対応方法が自明ではない、複数案を比較検討する必要がある）
- 予測可能性が低い（結果を事前に予測できない、副作用やリスクが多い）
- 前例がない（類似の問題を解決した経験がない、業界標準がない）
- 複数の専門領域にまたがる
- 技術的・ビジネス的制約が多い

### Step 4: 作業ステップの構築と提案

作業ステップを構築します。
このとき、以下の指針に従ってください。

**指針**

- 解像度の低い事柄を解消するようにステップを組む
  - 例えば、因果関係が不明確な場合、「背景・目的の整理」ステップを追加してください


**出力フォーマット**
```
## 提案内容
このタスクは複雑なため、現時点で確定できるステップのみを提案します。

1. {ステップ名}: {そのステップで行うこと}
2. {ステップ名}: {そのステップで行うこと}
...
N. 残りステップの再検討: 上記のステップで得られた結論をもとに、次に実施すべきステップを改めて検討する
```

**具体例**
```
## 提案内容
現時点で確定できるステップのみを提案します。

1. 既存のマイクロサービスアーキテクチャの調査: 現在のサービス間通信の実装方法、データフロー、障害時の挙動を調査する
2. パフォーマンス問題の原因特定: ボトルネックとなっている箇所を特定し、改善の方向性を検討する
3. 残りステップの再検討: 上記の調査結果をもとに、具体的な『改善アプローチ（キャッシュ導入、クエリ最適化、アーキテクチャ変更など）案の検討』などの以降のステップを改めて検討する
```

#### 作業ステップの種類

作業ステップを構築する際の参考として、一般的な作業ステップの種類を以下に示します。
タスクの性質に応じて、必要なステップを選択・組み合わせてください。

- **背景・目的の整理**: なぜこのタスクが必要なのか、何を達成したいのかを明確にする
- **既存システムの理解**: 今回のタスクに関連するシステムがどうなっているかの理解を深める
- **関連技術の理解**: 今回のタスクに関連する技術や概念について理解を深める
- **要件定義**: 機能要件、非機能要件を明確にする
- **観点の洗い出し**: 対応方針を検討する判断材料として、考えるべき観点（性能、可用性、セキュリティ、運用、工数 など）を列挙する
- **対応方針の検討**: (場合によっては複数の)解決策を検討し、最適な方針を決定する
- **技術選定**: どの技術・ライブラリ・アーキテクチャを採用するかを決定する
- **設計**: システム設計、データモデル設計、API設計などを行う
- **実装計画**: どのコードをどの順番で、どれくらいの粒度ごとに実装していくかを計画する
- **実装**: 実際にコードを書く
- **テスト作成・実行**: テストコードを作成し、動作確認を行う
- **検証環境上で動作確認**: 検証環境やステージング環境で実際の動作を確認する
- **PR作成**: 実装内容をPRにまとめる
- **レビュー修正**: レビューを受けて修正対応を行う
- **ドキュメント作成**: README、設計書、運用手順書などを作成する
- **残りステップの再検討**: 前段のステップで得られた結論をもとに、次に実施すべきステップを改めて検討する

#### 立ち止まるべき作業ステップ

以下に挙げる作業ステップは「タスクの解像度を上げるためのステップ」です。
逆に言うと、以下の作業ステップを行うということは、それが完了するまでタスクの解像度が低い状態ということです。
なので、以下の作業ステップを提案した場合、その次の作業ステップは必ず「**残りステップの再検討**」とし、そこで切り上げ、そこまでのステップをユーザーに提案してください。

- **背景・目的の整理**
  - 背景や目的が曖昧なことにはなにも判断できないので、このステップを行う場合は必ずここで一旦立ち止まる
- **対応方針の検討**
  - 対応方針が決まらないことには以降のステップを決められないので、このステップを行う場合は必ずここで一旦立ち止まる

