$1

PR作成後、レビュワーがレビューしやすくするために、主要な変更箇所に補足情報をインラインコメントとして追加します。

## 目的

- レビュワーのレビュー負担を最小化する
- コードの背景・意図を明確にする
- 実装方針の妥当性を説明する

## 入力で確認すること

- 対象PRのURLまたは番号
- PRの変更内容
- 実装時の設計判断や背景情報
- 情報が不足している場合は、着手前に質問を箇条書きする

## 出力の要件

- 作業結果を報告する（ドキュメントのようなストック型の出力は不要）
- どのファイルのどの行にどのような補足コメントを追加したかを報告する
- 補足情報は多すぎても少なすぎても良くない（レビュワーの負担を最小化）

## 手順

### 1. PRの変更内容を確認

- `gh pr diff` または `gh pr view` で変更内容を確認
- 主要な変更箇所を特定する
  - 新規追加されたクラス・メソッド
  - 重要なロジックの変更
  - 複雑なアルゴリズムの実装
  - 設計判断が必要だった箇所

### 2. 補足情報が必要な箇所を判断

以下のような箇所には補足情報を追加する：

- **コードの呼び出し元・利用箇所が自明でない場合**
  - どこから使われているのか
  - どのような経路で呼ばれるのか
  - 必要に応じて flow-trace スキルで処理フローを調査し、短くまとめて提示

- **実装方式の選択理由が不明瞭な場合**
  - なぜ他の実装方式ではなくこの実装方式を選んだか（why not）
  - どのような選択肢を検討したか
  - それぞれの選択肢の利点・欠点

- **変更範囲の妥当性が疑問に思われそうな場合**
  - なぜこの箇所の変更のみで必要十分か
  - なぜ他の関連箇所を変更しなくても問題ないのか
  - 過不足がないと言える理由

逆に、以下のような箇所には補足情報を追加しない：

- コードを読めば自明な変更
- 単純なリファクタリング
- 明らかなバグ修正
- PR説明文で十分に説明されている内容

### 3. 補足情報の作成

各補足箇所について、以下を簡潔に記載：

- **呼び出し元・利用箇所の補足**
  - 「このメソッドは XX から呼ばれます」
  - 「処理フロー: A → B → このメソッド → C」

- **実装方式の選択理由**
  - 「当初 XX を検討しましたが、YY の理由で ZZ を選択しました」
  - 「XX ではなく YY とした理由: ZZ」

- **変更範囲の妥当性**
  - 「XX は変更不要です。理由: YY」
  - 「この変更のみで十分な理由: XX」

### 4. インラインコメントの追加

`gh pr comment` コマンドを使って、該当行にインラインコメントを追加します。

**単一行へのコメント例（呼び出し元の説明）**:
```bash
gh pr comment <PR番号> \
  --body "このメソッドは UsersController#update から呼ばれます。
ユーザープロフィール更新時のバリデーションとメール送信を担当しています。
API経由とWeb UI経由の両方で使用されるため、汎用的な設計にしています。
管理画面からの更新は AdminUsersController 経由で別のフローを使用するため、このメソッドは通りません。" \
  --file app/services/user_updater.rb \
  --line 45
```

**複数行にわたるコメント例（実装方式の選択理由）**:
```bash
gh pr comment <PR番号> \
  --body "当初は ActiveRecord の callbacks を検討しましたが、以下の理由で Service Object パターンを選択しました。

1. テスタビリティ: callbacks だと User モデルのテストが複雑になる
2. ロジックの明示性: 更新処理の全体像が一箇所で把握できる
3. 再利用性: API/Web UI で同じロジックを共通化できる

callbacks だと副作用が暗黙的になり、デバッグも困難になると判断しました。" \
  --file app/services/user_updater.rb \
  --start-line 30 \
  --end-line 50
```

**処理フローの補足例**:
```bash
gh pr comment <PR番号> \
  --body "処理フロー:
UsersController#update → UserUpdater#call → User#save → UserMailer#notify

この Service を経由する理由は、更新とメール送信をトランザクションで包みたいためです。
User#save が失敗した場合、メール送信もロールバックされます。
また、将来的に Slack 通知などの処理を追加する際も、この Service に集約できます。" \
  --file app/services/user_updater.rb \
  --line 10
```

**変更範囲の妥当性の補足例**:
```bash
gh pr comment <PR番号> \
  --body "AdminUsersController は変更不要です。理由は以下の通りです。

管理画面では別の更新フロー（AdminUserUpdater）を使用しており、このサービスを経由しません。
管理画面では承認ワークフローが必要なため、ユーザー向けとは異なる実装になっています。
既存のテストでも AdminUsersController は UserUpdater に依存していないことを確認済みです。" \
  --file app/services/user_updater.rb \
  --line 5
```

注意事項：
- コメントは5行以内を目安とし、レビュワーの負担を最小化する
- 必要な情報を含めつつ簡潔に記述する
- 必要に応じて複数のコメントを追加するが、過剰にならないよう注意
- PR番号は `gh pr view` で確認できる

## チェックポイント

- [ ] PRの主要な変更箇所を正しく特定できているか
- [ ] 補足情報が必要な箇所を適切に判断できているか
- [ ] 必要に応じて flow-trace スキルで処理フローを調査したか
- [ ] 実装方式の選択理由が明確に説明されているか
- [ ] 変更範囲の妥当性が説明されているか
- [ ] 補足情報が多すぎず少なすぎないか（レビュワーの負担を最小化）
- [ ] インラインコメントが適切に追加されているか
