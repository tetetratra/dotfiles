---
name: architecture
description: タスクの技術アーキテクチャを詳細設計し、実装可能なレベルまで具体化する。
---

タスクの技術アーキテクチャを詳細設計し、実装可能なレベルまで具体化します。

注意：このコマンドは、高レベルな解決アプローチ（決定されている場合）を、詳細な技術仕様に落とし込むものです。
実装に必要な具体的な設計情報を整理することが目的です。

## 出力物

このコマンドでは、以下の3つのカテゴリで出力を行います：

- **返答**: 作業完了の報告や調査結果の要約など、フロー型の出力（会話として返す）
- **成果物**: ドキュメントや整理結果など、ストック型の出力（後から参照できる形で返す）
  - 成果物の保存先について指示がある場合は、指定された箇所に書き込む
  - 指示がない場合は、通常のレスポンスとして返答の後に続けて出力する
- **作業**: システムへの変更や実行など、副作用を伴う作業

本コマンドの出力：

**返答**: 設計完了を報告する

**成果物**: `## 設計` セクションの本文をレスポンスとして出力する

**作業**: なし

## 目的

- 確定した方針（ある場合）を参考に、実装可能な技術設計に具体化する
- 実装者が迷わず手を動かせる粒度まで構成・IF・データ設計を明示する

## 入力で確認すること

- 対象タスクのリンクと概要
- 現行システムの関連部分（構成図、コード、依存サービス）
- 技術的制約・非機能要件（性能/SLO/セキュリティ/可用性/コスト）
- スコープの前提と除外範囲、外部依存やリスク
- 情報不足があれば、質問を箇条書きするか仮置き前提として明示する

## 手順

1. **前提整理**: タスクの背景情報・方針等を確認し、スコープ・制約・非機能要件・除外範囲・外部依存をまとめる
2. **構成設計**: コンポーネント構成、データ/処理フロー、既存連携方法を決める
3. **詳細化**: 必要なファイル/クラス/メソッド、DB定義、API/イベント、UI変更点、設定・デプロイを列挙し役割と目的を説明する
4. **未決の明示**: 情報不足や決定待ち、外部リスクを箇条書きで記載する
5. **書式整形**: 下記テンプレートに沿って `## 設計` を作成し、不要セクションは省く
6. **自己チェック**: チェックポイントで粒度・固有性・未決事項・文体を確認する

## 成果物例 (テンプレート)

- よっぽどの必要性がない限り、以下テンプレートに無い見出しは設けないでください
- 具体的なコード等の記載は避けてください

```
## 設計

### アーキテクチャ構成
（この実装がどのようなコンポーネントで構成されるかを説明）
（既存のシステムとの連携方法も含める）
（データの流れや処理の流れも説明）

### クラス設計

- app/
  - controllers/
    - xxx_controller.rb
      - （このファイルで実装する内容と役割を説明）
      - #show
        - （実装予定のメソッドは全て列挙する必要はありません。重要だと判断したメソッドのみ列挙してください）
        - （実装内容が複雑なメソッドであれば説明を簡潔に記載してください。単純な処理であれば説明は不要です）
        - （文がごちゃつくので、引数の詳細を書いたりその説明をしたりする必要はありません）
  - models/
    - ...
  - views/
    - ...
  - ...

### データベース設計
- xxx テーブル
  - （このテーブルを作成・変更する理由と用途を説明）
  - （他テーブルとの関係性、インデックス設計も記載）
  - カラム設計:
    - column_name: データ型 - 用途説明
    - ...
- yyy テーブル

（データベースに無関係な実装の場合はこのセクションをスキップ）
（この実装に関係しないテーブルについては説明不要）

### API設計
- POST /api/xxx
  - （このエンドポイントの用途と処理内容を説明）
  - リクエスト: { "param": "value" }
  - レスポンス: { "result": "success" }
- GET /api/yyy

（APIが不要な実装の場合はこのセクションをスキップ）

### UI設計
（フロントエンド実装が必要な場合、どのようなコンポーネント・画面を実装するかを記載）
（既存UIの変更点も含める）
（UI実装が不要な場合はこのセクションをスキップ）

### 設定・デプロイ
（実装に必要な環境設定、デプロイ手順、マイグレーション等を記載）
（既存システムへの影響も含める）
（設定・デプロイに関係しない場合はこのセクションをスキップ）
```

## チェックポイント

- [ ] 方針を実装可能な設計に落とし込めているか
- [ ] スコープ前提と除外範囲、外部依存・リスクが明記されているか
- [ ] 実装者が迷わない粒度で構成・IF・データ・設定が具体化されているか
- [ ] 不要セクションを省き、必要セクションは過不足なく埋まっているか
- [ ] 一般論ではなく今回特有の内容にフォーカスしているか
- [ ] ですます調で、箇条書き末尾に句点がないか
- [ ] 未決事項が明示され、実装タスクとしてタスク化できる状態か
