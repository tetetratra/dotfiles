---
description: テストファイルのマージコンフリクトを、構造を保ちながら安全に解消する手順
---

テストファイル（特にRSpecのような階層構造を持つテストファイル）のマージコンフリクトを解消する際の手順です。既存のテスト構造を保ちながら、ブランチ固有の変更のみを安全に統合します。

## 手順

### 1. ブランチ固有の変更を特定する

推測で作業せず、実際のコミット履歴から変更内容を確認：

- `git log --oneline` でブランチのコミット一覧を確認
- 該当コミットの変更内容を `git show <commit-hash>` で確認
- テストファイルに対する変更が何かを正確に把握

### 2. テスト構造の可視化と提示

コンフリクト解消前に、ユーザーに構造を提示して承認を得る：

```bash
# 現在のマージ元（develop等）の構造を表示
git show <branch>:<test-file-path> | grep -E 'describe |context |it '

# 解消後の構造案を提示
# （解消後のイメージを文章やgrep出力で説明）
```

**重要**: 実際の変更作業の前に、必ずユーザーの承認を得る

以下の原則に従うこと：

- **既存テストに極力diffを発生させない**
  - マージ元（develop等）の構造をそのまま保持
  - 変更が必要な部分だけをピンポイントで置き換え
  - 不要な restructuring を避ける

### 3. コンフリクト解消の実施

段階的に作業を進める：

1. マージ元の内容を採用（`git checkout --theirs` 等）
2. ブランチ固有の変更部分のみを特定
3. Editツールで該当箇所をピンポイントで置き換え
4. `git add` でコンフリクト解消をマーク

### 4. 確認とコミット

- `git status` でコンフリクトが解消されたか確認
- 可能であればテストを実行して動作確認
- マージコミットを作成
