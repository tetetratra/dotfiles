---
name: pr-followup
description: PR作成後のCI失敗・レビュー指摘・コンフリクトを確認し、優先順位をつけて対応する。
---

PR作成後に発生する問題（CI失敗、レビュー指摘、コンフリクト）を確認し、優先順位をつけて対応します。

## 出力物

このコマンドでは、以下の3つのカテゴリで出力を行います：

- **返答**: 作業完了の報告や調査結果の要約など、フロー型の出力（会話として返す）
- **成果物**: ドキュメントや整理結果など、ストック型の出力（後から参照できる形で返す）
  - 成果物の保存先について指示がある場合は、指定された箇所に書き込む
  - 指示がない場合は、通常のレスポンスとして返答の後に続けて出力する
- **作業**: システムへの変更や実行など、副作用を伴う作業

本コマンドの出力：

**返答**: 何を確認し、何を修正したかを簡潔に報告し、レビューコメントへの返信案を提示する

**成果物**: なし

**作業**: CI失敗の修正、レビュー指摘の対応、コンフリクトの解消、コミット、プッシュ、PR説明の更新

## 目的

- PR作成後のCI失敗、レビュー指摘、コンフリクトなどの問題を把握する
- 優先順位をつけて対応する
- 修正後に適切に確認・コミット・プッシュする
- 必要に応じてPR説明を更新する

## 手順

### 1. PR状態の確認

以下を確認して、どのような問題があるかを把握する：

- CI状態の確認（`gh pr checks`）
  - 失敗しているジョブの特定
  - circleci等のMCPツールが使える場合、それを使って失敗しているテストやログを確認する
- レビューコメントの確認（`gh pr view --comments`）
  - 未解決のコメントを抽出
  - 対応が必要な指摘を整理
- コンフリクトの有無（`gh pr view` の Mergeable 状態）
  - コンフリクトが発生しているか確認

### 2. 対応優先度の決定

以下の優先順位で対応する：

1. **コンフリクトの解決**（最優先）
   - コンフリクトがあると他の作業が無駄になる可能性があるため
   - ベースブランチの最新を取得
   - プロジェクトのルールに従って rebase または merge を実行
   - コンフリクト箇所を手動で解決
   - テスト実行で問題ないか確認
   - force push（rebaseの場合）または通常push

2. **CI失敗の修正**
   - 失敗したジョブのログを分析
   - 失敗原因の特定（テスト失敗、Lint、型エラー、ビルドエラーなど）
   - 修正方針の決定
   - 修正実装
   - ローカルで該当テスト/チェックを実行して確認
   - コミット・プッシュ

3. **レビュー指摘への対応**
   - 未解決のコメントを1つずつ確認
   - 各指摘に対する対応方針を決定：
     - 修正が必要 → 実装して対応
     - 説明が必要 → 返信案を作成（実際の返信は人間が行う）
     - 議論が必要 → 返信案を作成（実際の返信は人間が行う）
   - 修正が必要なものを実装
   - テスト実行
   - コミット・プッシュ
   - レビューコメントへの返信案を報告（どのような返答をすると良いか）

### 3. 追加の動作確認（必要な場合）

- レビュアーから指摘された追加確認項目の実施
- 修正による影響範囲の確認
- 追加実装に対する動作確認

### 4. PR説明の更新（必要な場合）

- 追加変更に伴う背景・目的の補足
- 追加変更に伴う変更内容の更新
- 追加の動作確認結果の追記
- レビュアーからの質問への回答をPR説明に反映

## チェックポイント

- [ ] circleci等のMCPツールを使ってCI失敗を確認したか
- [ ] 対応優先度が適切か（コンフリクト > CI > レビュー）
- [ ] 修正後にローカルで確認を実施しているか
- [ ] コミット・プッシュが適切に行われているか
- [ ] レビューコメントへの返信案を提示したか（実際の返信は人間が行う）
- [ ] 必要に応じてPR説明を更新しているか
